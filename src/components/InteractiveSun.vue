<template>
    <div class="sun-wrapper">
        <!-- 
      我們在主要的 SVG 元素上加上 @click 事件。
      這樣使用者點擊太陽的任何部位，都能觸發表情變換。
      同時加上 cursor: pointer 的樣式，提示使用者這裡是可點擊的。
    -->
        <svg
            width="255"
            height="255"
            viewBox="0 0 255 255"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            @click="cycleEmotion"
            style="cursor: pointer"
        >
            <!-- 旋轉的陽光 -->
            <path
                id="sunshine"
                d="M126.741 1.8839C127.14 1.41904 127.86 1.41904 128.259 1.8839L152.887 30.5737C153.156 30.8865 153.588 31.0024 153.977 30.8658L189.651 18.3339C190.229 18.1308 190.852 18.4905 190.965 19.0927L197.949 56.2529C198.025 56.658 198.342 56.9749 198.747 57.051L235.907 64.0348C236.509 64.148 236.869 64.7711 236.666 65.3491L224.134 101.023C223.998 101.412 224.114 101.844 224.426 102.113L253.116 126.741C253.581 127.14 253.581 127.86 253.116 128.259L224.426 152.887C224.114 153.156 223.998 153.588 224.134 153.977L236.666 189.651C236.869 190.229 236.509 190.852 235.907 190.965L198.747 197.949C198.342 198.025 198.025 198.342 197.949 198.747L190.965 235.907C190.852 236.509 190.229 236.869 189.651 236.666L153.977 224.134C153.588 223.998 153.156 224.114 152.887 224.426L128.259 253.116C127.86 253.581 127.14 253.581 126.741 253.116L102.113 224.426C101.844 224.114 101.412 223.998 101.023 224.134L65.3491 236.666C64.7711 236.869 64.148 236.509 64.0348 235.907L57.051 198.747C56.9749 198.342 56.658 198.025 56.2529 197.949L19.0927 190.965C18.4905 190.852 18.1308 190.229 18.3339 189.651L30.8658 153.977C31.0024 153.588 30.8865 153.156 30.5737 152.887L1.8839 128.259C1.41904 127.86 1.41904 127.14 1.8839 126.741L30.5737 102.113C30.8865 101.844 31.0024 101.412 30.8658 101.023L18.3339 65.3491C18.1308 64.7711 18.4905 64.148 19.0927 64.0348L56.2529 57.051C56.658 56.9749 56.9749 56.658 57.051 56.2529L64.0348 19.0927C64.148 18.4905 64.7711 18.1308 65.3491 18.3339L101.023 30.8658C101.412 31.0024 101.844 30.8865 102.113 30.5737L126.741 1.8839Z"
                fill="#FF6655"
                stroke="black"
                stroke-width="3"
                stroke-linejoin="round"
            />
            <!-- 太陽的臉 -->
            <circle
                ref="sunFace"
                cx="128"
                cy="128"
                r="91"
                fill="#FADA7A"
            />

            <!-- 表情容器，用 :style 來做眼球追蹤 -->
            <!-- 這裡的 v-if / v-else-if 邏輯完全不需要改變 -->
            <g
                id="facial-expression"
                :style="facialExpressionStyle"
            >
                <!-- 正常 / 開心 -->
                <g v-if="emotion === 'normal'">
                    <circle
                        cx="90"
                        cy="118"
                        r="10"
                        fill="black"
                    />
                    <circle
                        cx="160"
                        cy="118"
                        r="10"
                        fill="black"
                    />
                    <path
                        d="M103 159C104.961 163.667 112.632 173 127.632 173C142.632 173 150.794 163.667 153 159"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                </g>

                <!-- 眨眼 -->
                <g v-else-if="emotion === 'wink'">
                    <path
                        d="M80 119L99.5 129L80 136.5"
                        stroke="black"
                        stroke-width="5"
                        stroke-linecap="round"
                    />
                    <path
                        d="M175.5 118L156 128L175.5 135.5"
                        stroke="black"
                        stroke-width="5"
                        stroke-linecap="round"
                    />
                    <path
                        d="M103 159C104.961 163.667 112.632 173 127.632 173C142.632 173 150.794 163.667 153 159"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                </g>

                <!-- 嘟嘴 -->
                <g v-else-if="emotion === 'pout'">
                    <path
                        d="M110.911 150C108.248 152.667 111.636 158 118.294 158C124.952 158 126.446 154.741 128 152.667"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                    <path
                        d="M145.089 150C147.752 152.667 144.364 158 137.706 158C131.048 158 129.554 154.741 128 152.667"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                    <path
                        d="M115.878 158C115.184 163.547 123.643 167.986 127.942 166.045"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                    <path
                        d="M112 86.1718C101.5 77.6718 88.4713 82.3182 83 98.6719"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                    <path
                        d="M143 88.5C153.5 79.9999 166.529 84.6463 172 101"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                    <circle
                        cx="97"
                        cy="129"
                        r="10"
                        fill="black"
                    />
                    <circle
                        cx="160"
                        cy="129"
                        r="10"
                        fill="black"
                    />
                </g>

                <!-- 難過 -->
                <g v-else-if="emotion === 'sad'">
                    <path
                        d="M92 118C89.7647 119.5 84.2353 122.8 80 124"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                    <path
                        d="M163 118C165.235 119.5 170.765 122.8 175 124"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                    <circle
                        cx="90"
                        cy="139"
                        r="10"
                        fill="black"
                    />
                    <circle
                        cx="160"
                        cy="139"
                        r="10"
                        fill="black"
                    />
                    <path
                        d="M164.913 152C163.913 155 162.213 161.2 163.413 162C164.913 163 166.913 166.5 169.913 163.5C172.313 161.1 170.913 156.833 169.913 155"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M103 179C104.961 174.333 112.632 165 127.632 165C142.632 165 150.794 174.333 153 179"
                        stroke="black"
                        stroke-width="3"
                        stroke-linecap="round"
                    />
                </g>

                <!-- 大哭 -->
                <g v-else-if="emotion === 'crying'">
                    <path
                        d="M105.5 74C103 75.3333 96.5 78.2 90.5 79"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M95.5 90C101.1 90.4 102.833 92.8334 103 94C98.5 95.5 97.5 94 92.5 94C87.5 94 77.5 96.5 78 96C78.5 95.5 88.5 89.5 95.5 90Z"
                        fill="black"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M73 100.5C73 103 74.1 107.7 78.5 106.5C82.9 105.3 83.3333 111.333 83 114.5C82.5 119 82.6 127.8 87 127C92.5 126 90.5 112.5 91.5 110C92.5 107.5 94.5 105 96 104.5C97.2 104.1 98.1667 101 98.5 99.5"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M82.4999 133.5C81.8332 135.833 81.2999 140.7 84.4999 141.5C87.6999 142.3 89.4999 138.167 89.9999 136"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M160.667 79.5C162.667 80.4333 168.067 82.54 173.667 83.5"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M174.218 96.0426C170.643 94.4628 162.467 94.3969 158.825 94.5615C155.846 96.0426 159.322 97.5238 161.308 97.0301C163.294 96.5364 167.763 99.0049 170.246 99.9924C172.729 100.98 181.667 104.93 181.667 102.955C181.667 100.98 178.687 98.0175 174.218 96.0426Z"
                        fill="black"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M167.667 102.5C167.667 104.345 168.267 108.496 170.667 110.34C173.667 112.646 174.167 114.03 174.167 117.719C174.167 121.409 174.667 129.71 176.667 130.172C178.667 130.633 183.167 131.555 182.667 125.099C182.267 119.933 182.5 116.49 182.667 115.413C183.333 114.184 184.667 111.263 184.667 109.418"
                        stroke="black"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M130.048 120.09C131.627 119.766 132.945 120.374 133.966 121.123C134.936 121.835 135.85 122.851 136.452 123.418C136.92 123.86 137.562 124.215 139.323 124.547C141.104 124.883 143.866 125.169 148.457 125.574C151.353 125.83 152.829 127.677 153.68 129.545C153.824 129.709 153.909 129.914 153.925 130.127C154.283 131.034 154.537 131.96 154.754 132.703C155.01 133.584 155.192 134.1 155.378 134.354C156.111 135.356 157.031 136.513 157.737 137.711C158.453 138.926 159.027 140.307 159.03 141.843C159.033 143.705 157.579 144.948 156.534 145.787C155.508 146.611 154.404 147.062 153.477 147.361C153.02 147.509 152.582 147.627 152.239 147.724C151.871 147.828 151.634 147.903 151.478 147.975C149.985 148.666 148.597 147.903 147.639 147.365C146.534 146.745 145.659 146.205 144.631 146.162C141.11 146.015 139.121 146.759 136.149 147.991C134.602 148.633 132.656 148.585 131.129 148.44C130.346 148.365 129.618 148.258 129.056 148.178C128.77 148.137 128.536 148.104 128.348 148.084C128.256 148.074 128.183 148.068 128.129 148.066C128.088 148.063 128.066 148.064 128.06 148.064C127.284 148.13 126.539 147.844 125.911 147.506C125.268 147.16 124.616 146.684 124.002 146.213C123.363 145.723 122.776 145.249 122.171 144.814C121.572 144.382 121.035 144.048 120.554 143.853C119.474 143.415 118.593 143.474 117.499 143.646C116.404 143.817 115.033 144.122 113.313 143.919C111.923 143.755 110.84 143.026 109.875 142.349C108.872 141.645 107.922 140.938 106.629 140.442C106.366 140.342 106.059 140.296 105.667 140.249C105.35 140.212 104.818 140.165 104.395 139.988C103.422 139.582 103.158 138.559 103.066 137.885C102.964 137.137 103.001 136.254 103.037 135.501C103.111 133.928 104.11 132.647 105.216 131.637C106.339 130.612 107.763 129.698 108.992 128.9L109.038 128.87L109.087 128.846C109.25 128.764 109.399 128.693 109.529 128.633C109.663 128.57 109.768 128.522 109.863 128.475C110.053 128.38 110.125 128.326 110.161 128.291L110.237 128.223C110.5 128.011 110.846 127.952 111.155 128.046C111.378 127.93 111.626 127.796 111.903 127.644C112.731 127.187 113.786 126.582 115.12 125.84C115.15 125.798 115.185 125.757 115.223 125.719C115.401 125.542 115.628 125.445 115.86 125.429C116.453 125.102 117.096 124.753 117.792 124.381C120.572 122.895 122.622 122.483 124.21 122.237C125.85 121.984 126.613 121.92 127.343 121.325C128.113 120.699 129.189 120.266 130.048 120.09ZM112.869 129.395C111.691 130.044 110.738 130.532 109.904 130.692C108.695 131.477 107.496 132.264 106.565 133.114C105.573 134.02 105.07 134.834 105.034 135.596C104.997 136.383 104.975 137.079 105.047 137.614C105.097 137.981 105.171 138.114 105.197 138.152C105.302 138.187 105.487 138.214 105.902 138.263C106.285 138.308 106.821 138.374 107.344 138.574C108.915 139.176 110.076 140.047 111.023 140.712C112.007 141.403 112.715 141.835 113.547 141.933C114.929 142.096 115.975 141.86 117.188 141.67C118.401 141.48 119.719 141.356 121.305 141.999C122.01 142.285 122.702 142.73 123.341 143.191C123.975 143.647 124.636 144.18 125.218 144.626C125.825 145.091 126.369 145.481 126.86 145.745C127.365 146.017 127.692 146.088 127.89 146.071C128.106 146.053 128.355 146.074 128.562 146.096C128.789 146.12 129.057 146.157 129.338 146.197C129.913 146.279 130.591 146.379 131.319 146.448C132.817 146.591 134.328 146.581 135.382 146.144C138.435 144.877 140.751 143.999 144.714 144.164C146.328 144.232 147.676 145.094 148.618 145.622C149.706 146.233 150.191 146.367 150.637 146.16C150.957 146.012 151.343 145.898 151.694 145.799C152.07 145.692 152.451 145.591 152.863 145.458C153.676 145.196 154.523 144.837 155.282 144.228C156.427 143.308 157.031 142.626 157.03 141.846C157.028 140.813 156.642 139.793 156.013 138.727C155.375 137.643 154.566 136.633 153.763 135.535C153.327 134.939 153.06 134.039 152.834 133.262C152.74 132.94 152.643 132.615 152.545 132.288C152.523 132.312 152.503 132.337 152.481 132.359C152.356 132.491 152.176 132.672 152.002 132.788L151.153 133.355L151.069 133.41L150.976 133.447C149.39 134.095 146.986 135.189 143.819 135.17C135.388 135.12 133.457 134.903 131.593 134.64C130.579 134.497 129.332 134.391 127.93 134.215C126.62 134.05 125.222 133.828 124.251 133.45L124.215 133.437C122.799 132.887 120.791 132.119 119.437 130.966C118.433 130.111 116.797 128.622 115.843 127.727C114.644 128.396 113.68 128.947 112.869 129.395ZM132.783 122.735C131.991 122.154 131.25 121.885 130.451 122.049C129.829 122.177 129.072 122.498 128.607 122.876C127.354 123.896 125.91 123.998 124.515 124.214C123.067 124.438 121.252 124.8 118.734 126.146C118.37 126.34 118.022 126.53 117.689 126.711C118.62 127.573 119.901 128.735 120.733 129.443C121.778 130.333 123.43 130.987 124.939 131.572L124.974 131.586L125.261 131.686C125.979 131.912 127.016 132.084 128.18 132.231C129.419 132.386 130.891 132.521 131.873 132.659C133.603 132.903 135.427 133.121 143.831 133.17C146.485 133.186 148.5 132.301 150.126 131.634L150.892 131.124C150.86 131.145 150.901 131.119 151.035 130.979C151.146 130.862 151.282 130.709 151.422 130.543C151.54 130.404 151.65 130.264 151.749 130.138C151.064 128.742 150.072 127.725 148.281 127.567C143.717 127.163 140.849 126.869 138.952 126.512C137.036 126.15 135.953 125.697 135.08 124.873C134.282 124.12 133.626 123.354 132.783 122.735Z" fill="black"/>
                    />
                </g>
            </g>
        </svg>
        <p>點擊太陽來看看不同的表情！</p>
    </div>
</template>

<script setup>
import { ref, reactive, onMounted, onUnmounted, computed } from "vue";

// --- 狀態管理 ---
// 建立一個包含所有表情的陣列，方便循環
const emotionCycle = ["normal", "wink", "pout", "sad", "crying"];
// 用一個 ref 來追蹤當前表情在陣列中的索引
const currentEmotionIndex = ref(0);
// 使用 computed 屬性，根據索引自動得到當前的表情字串
const emotion = computed(() => emotionCycle[currentEmotionIndex.value]);

const sunFace = ref(null);
let animationFrameId = null;

// --- 眼球追蹤邏輯 (這部分完全不變) ---
const mouseTarget = reactive({ x: 0, y: 0 });
const mouseCurrent = reactive({ x: 0, y: 0 });

const facialExpressionStyle = computed(() => {
    return {
        transform: `translate(${mouseCurrent.x}px, ${mouseCurrent.y}px)`,
    };
});

const handleMouseMove = (e) => {
    if (!sunFace.value) return;
    const rect = sunFace.value.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    const dx = e.clientX - centerX;
    const dy = e.clientY - centerY;
    const angle = Math.atan2(dy, dx);
    const r = 10;
    mouseTarget.x = Math.cos(angle) * r;
    mouseTarget.y = Math.sin(angle) * r;
};

const animate = () => {
    const ease = 0.1;
    mouseCurrent.x += (mouseTarget.x - mouseCurrent.x) * ease;
    mouseCurrent.y += (mouseTarget.y - mouseCurrent.y) * ease;
    animationFrameId = requestAnimationFrame(animate);
};

// --- 新的點擊事件處理函式 ---
const cycleEmotion = () => {
    // 將索引值 +1
    const nextIndex = currentEmotionIndex.value + 1;
    // 如果索引超出了陣列範圍，就回到開頭 (0)，否則就使用新的索引
    // 使用 % (模數) 運算子可以更簡潔地完成循環
    currentEmotionIndex.value = nextIndex % emotionCycle.length;
};

// --- 生命週期 (這部分完全不變) ---
onMounted(() => {
    document.addEventListener("mousemove", handleMouseMove);
    animate();
});

onUnmounted(() => {
    document.removeEventListener("mousemove", handleMouseMove);
    if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
    }
});
</script>

<style scoped>
.sun-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

#sunshine {
    animation: rotateSun 8s linear infinite;
    transform-origin: center center;
}

@keyframes rotateSun {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

p {
    font-size: 1.2rem;
    color: #555;
    font-weight: bold;
}
</style>
